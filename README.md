# 💰 記帳小浣熊 (Accountant Raccoon) 
**LINE 上最先進的 AI 記帳夥伴 🦝✨**

在財務管理需兼顧效率與洞察的時代，**記帳小浣熊** 應用程式代表了人工智慧、即時通訊與安全資料儲存的精密整合。🧠💻 該系統以 Python 語言開發，採用 Flask 框架處理 LINE Webhook 事件，整合 Google Gemini AI 進行自然語言處理、LINE 提供無縫使用者互動，以及 Google Sheets 確保資料持久性。此解決方案將例行支出追蹤轉化為智能對話體驗，使用者可輕鬆維持精準財務記錄，宛如擁有一位貼心的小幫手！🦝📝

> 記帳從單純任務演進為引人入勝的對話，由先進 AI 能力驅動。🔥💫

---

## ✨ **核心功能** 🌟

### 🧠 **先進 AI 整合 (Gemini 2.5 Flash Lite)** 🚀
系統採用 Google Gemini 不僅作為指令解讀器，更作為能辨識使用者輸入脈絡細微差異的直覺 AI。它擅長解析自然語言，以實現精準分類與時間分析，讓記帳變得如聊天般自然！😊
- **NLP 解析規則**：支援明確時間參照 (例如：「昨天 16:22 購買零食 100」🕒)、多筆拆分 (例如：「午餐 100 晚餐 200」🍽️)，以及算術運算式 (例如：「59x2 + 35」解析為 153 💹)。
- **時間邏輯**：優先採用使用者指定日期與時間；否則預設為訊息時間戳 (精準至秒 ⏱️)；從關鍵字推斷合理時間 (例如：「早餐」設為 08:00:00 ☕)。
- **自動分類**：從八種預定義類別中智能選擇 (餐飲、飲料、交通、娛樂、購物、日用品、雜項、收入)，輕鬆捕捉生活點滴！🎯
> **範例**：「午餐雞排 80」→ 自動分類為餐飲支出 (-80 元)，時間戳記為當日 12:00:00 🍗😋

### 🦝 **智能且吸引人的角色互動** 💕
對於非記帳輸入，Gemini 以機智浣熊角色回應，將實用性與魅力融合，以提升使用者參與度。讓小浣熊成為你的理財小夥伴，帶來一絲溫暖與樂趣！🫂
- **個人化回覆**：記帳後回應隨機變化 (例如：「飽足充滿活力！ 🍜 (⁎⁍̴̛ᴗ⁍̴̛⁎)」😄)。
- **對話處理**：如問候「你好」將回應：「問候！我是記帳小浣熊 🦝。需要協助記錄支出，還是偏好閒聊？」👋。
- **錯誤引導**：模糊輸入 (例如：「宵夜」) 將提示：「🦝？宵夜吃了什麼，花費多少？」🤔。

### 💬 **原生 LINE 整合** 📱
使用者可直接透過 LINE 互動，無需額外應用程式，確保可及性與即時性。隨時隨地記帳，輕鬆如發訊息！⚡
- **Webhook 驗證**：採用 LINE 簽名驗證，防範無效請求 🔒。
- **事件處理**：僅回應 TextMessage 事件，支援多裝置使用 📲。
- **記錄**：全面 DEBUG 等級記錄，便於診斷與優化 🛠️。

### 📊 **Google Sheets 後端** 🗂️
- **資料結構**：Transactions 工作表 (日期、類別、金額、使用者 ID、使用者名稱、備註) 📈；Budgets 工作表 (使用者 ID、類別、限額) 💰。
- **初始化**：首次運行自動建立工作表與標頭，無需手動設定 🎉。
- **安全性**：使用服務帳戶憑證 (JSON 格式)，僅限 spreadsheets 範圍，資料安全無虞 🛡️。
- **相容性**：支援舊版 '時間' 欄位，無縫遷移至 '日期'，舊資料不遺失 🔄。

---

## 🚀 **功能概覽** 📋

| 功能類型 | 範例輸入 | 效果與細節 🎯 |
|----------|----------|--------------|
| **快速記帳 (單筆/多筆)** 🛒 | `午餐雞排 80`<br>`午餐 100 晚餐 200 飲料 50`<br>`水果條 59x2 + 奶茶 35` | AI 解析時間、類別、金額 (支出為負數)；拆分多筆；處理加法/乘法 (例如：59*2=118)；精準時間戳記 ⏰。 |
| **收入記錄** 💵 | `收入 薪水 30000`<br>`昨天獎金 5000` | 正值記錄為收入；免於預算警示，慶祝小成就！🎊 |
| **智能查詢 (關鍵字/日期)** 🔍 | `查詢 雞排`<br>`查詢 本週餐飲`<br>`查詢 上月收入` | NLP 提取關鍵字/日期範圍 (例如：「本週」→ 週一至週日)；顯示最近 20 筆記錄與總計；無匹配則提供禮貌引導 😊。 |
| **對話式分析** 💭 | `本月花費過多嗎？`<br>`預算剩多少？` | AI 標記為查詢；比較本月 vs. 上月 (例如：「本月超出 15%！ 😱」)；轉交預算檢視，溫柔提醒 🔔。 |
| **餘額查詢** 📊 | `查帳` | 顯示總收入、支出、淨餘額 (例如：「淨餘額：+500」)；無記錄則鼓勵開始記帳，來吧！🚀 |
| **月結報表** 📅 | `月結` | 本月收入/支出/淨利；前三支出類別 (例如：「🥇 餐飲：2500」)，一目了然！👀 |
| **本週重點** 📈 | `本週重點` (或 `本周重點`) | 本週總支出；類別百分比 (例如：「餐飲：45%」)；每日高峰花費 (例如：「最高日：10/25 (800)」) 📉。 |
| **總收支分析** 🔄 | `總收支分析` | 全期收入/支出/淨餘額；前三類別百分比 (例如：「🥇 購物：30.5%」)，洞察未來！🌟 |
| **預算管理** 🛡️ | `設置預算 餐飲 3000`<br>`查看預算` | 建立/更新每月限額 (僅支出)；進度條 (例如：「[■■■■□□□□□□] 40%」)；警示剩餘 (例如：「🔔 剩 200！」)；即時檢查 (90% 警告、100% 警報) ⚠️。 |
| **安全刪除** 🗑️ | `刪除` (最新一筆)<br>`刪除 雞排`<br>`刪除 昨天`<br>`確認刪除` | 單筆直接移除；進階預覽 (最多顯示 5 筆，>30 筆警示)；5 分鐘快取確認；僅限本人記錄，安心操作！👍 |
| **系統查詢** ❓ | `幫助`<br>`有哪些類別？` | 完整指令清單；列舉八種類別 (例如：「🍽️ 餐飲 🥤 飲料 ... 💰 收入」)，輕鬆上手！🦝 |

---

## 💡 **浣熊的智能機制** 🧠💖

- **⌚ 精準時間記錄**：記錄捕捉年、月、日、時、分、秒，以利細粒度回顧。採用 `zoneinfo` 處理時區 (預設：Asia/Taipei；可經 APP_TZ 自訂)，永不錯過一刻！⏳
- **🚀 多筆與算術支援**：AI 拆分複雜輸入；備援本地解析器處理運算式 (例如：「180+60+135」→ -375 單筆)；合併 AI 誤解析同類別記錄，聰明又高效！⚡
- **📅 先進日期辨識**：NLP 處理相對日期 (例如：「昨天」、「本週」、「上月」)；轉換為 YYYY-MM-DD 範圍用於查詢/刪除；邊緣案例 (例如：19:36 的「下午茶」視為備註，而非時間)，細膩體貼！🌙
- **🧹 自動分類**：「早餐/午餐/晚餐/宵夜」→ 餐飲；「飲料/咖啡/奶茶」→ 飲料；模糊詞 (例如：「加油」) → 交通，捕捉生活小細節！✨
- **🛡️ 安全與錯誤處理**：驗證金鑰 (LINE Token 正則)；GSheet 欄位防護 ('日期'/'時間')；刪除預覽 + 確認；預算僅適用支出，保護你的資料如寶貝！💎
- **📈 即時摘要與警示**：記帳後顯示記錄摘要 (例如：「3 筆」) + 淨餘額；預算超支觸發樣式警示 (例如：「🚨 超支 500！ 😱」)，及時守護！🛑
- **🤖 習慣適應**：Gemini 依脈絡精煉 (例如：頻繁「雞排」→ 更快餐飲分類)；支援全形符號 (例如：「＋」、「＊」)，越用越懂你！❤️
- **🔧 開發友好**：DEBUG 記錄；dotenv 環境變數；Flask 於 PORT 10000 (可配置)，易於擴展與維護！🛠️

> **程式碼亮點**：核心路由器 (handle_message) 優先處理明確指令，再落入 NLP；實用函式如 `get_cute_reply` 提升互動；`delete_preview_cache` 實現定時臨時儲存 (5 分鐘過期)，小巧卻強大！🌟

---

## 🛠️ **安裝與使用指南** 📖

為開始使用記帳小浣熊，請遵循以下聚焦於終端使用者透過 LINE 的簡明步驟。一步步來，小浣熊會陪你！🦝👣

### 1. **存取 LINE Bot** 🔗
- 開啟 LINE 應用程式並搜尋 Bot ID：`@575rjlmq` 📱。
- 或者，點擊下方連結直接新增「記帳小浣熊」：  
「[記帳小浣熊 LINE 連結](https://line.me/R/ti/p/@575rjlmq)」

### 2. **啟動記帳** 🚀
- **快速輸入**：輸入 `午餐 120 晚餐 200`，由 AI 協助拆分與分類，輕鬆記錄一整天！🍲
- **收入記錄**：輸入 `收入 薪水 30000`，追蹤正值，慶祝收入到手！💰🎉
- **智能查詢**：使用 `查詢 本週`，擷取本週記錄與摘要，一覽無遺！📊
- **預算控制**：指令 `設置預算 餐飲 3000` 建立限額；`查看預算` 檢視進度視覺化，掌控花費！🛡️
- **餘額查詢**：提交 `查帳` 以獲全面概覽，隨時掌握財務脈動！📈
- **安全移除**：輸入 `刪除 雞排` 進行預覽，後續 `確認刪除` 執行，無憂修正！🗑️

### 3. **進階提示** 💡
- **多使用者隔離**：記錄依使用者 ID 分離，以確保隱私，每人獨享帳本！🔒
- **資料匯出**：直接從底層 Google Sheets 下載 CSV/Excel，備份隨心！💾
- **自訂**：修改回應字典 (例如：`get_cute_reply`) 以量身訂製互動，增添個人風格！🎨
- **支援**：於 Bot 內輸入 `幫助` 以獲盡詳盡指令文件，小浣熊隨時解答！❓🦝

---

## 🎯 **為何選擇記帳小浣熊？** 🌈

- 🧠 **智能性**：Gemini 驅動自然語言解析，確保快速、精準分類，並支援複雜輸入，讓記帳如魔法般簡單！🪄
- ⚡ **便利性**：原生 LINE 操作，便利記帳與即時回饋，隨時啟動財務之旅！📱
- 🦝 **吸引力**：魅力浣熊互動，使記帳少枯燥；對話式分析提供如同同事般的洞察，溫暖陪伴！💕
- 🔒 **可靠性**：強健錯誤處理、快取機制與 GSheets 備份；開源程式碼支援擴展性，穩如泰山！🛡️
- 📈 **全面性**：涵蓋記帳、分析、預算與刪除；預備擴充如趨勢預測，未來無限可能！🚀

> 記帳小浣熊使財務管理直覺且具洞察力。  
> 超越單純計算，闡明財政決策本質，與你共創財富故事！💭🦝  

**儲存庫**： [GitHub Repo](https://github.com/Leo103222/Line-bot-Accounting-Raccoon) 📂  
**聯絡**：如有疑問，於 LINE Bot 輸入「幫助」或電郵 hanwei103222@gmail.com。📧  
**版本**：v2.2 (2025 年 10 月 26 日) – 持續精進中，期待你的反饋！🦝✨
